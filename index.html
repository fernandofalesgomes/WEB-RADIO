<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Player Autom√°tico Playlist JSON</title>
  <style>
    body { font-family:'Segoe UI',Arial,sans-serif; background:#0d0d0d; color:#fff; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; margin:0; }
    h1 { margin-bottom:30px; font-size:2rem; letter-spacing:1px; }
    #player-container { background:#1a1a1a; padding:30px 40px; border-radius:20px; box-shadow:0 0 30px rgba(0,255,150,0.2); text-align:center; max-width:400px; width:90%; }
    audio { display:none; }
    .controls { display:flex; justify-content:center; margin-top:20px; }
    .controls button { background:#00ff99; border:none; border-radius:50%; width:80px; height:80px; font-size:2rem; cursor:pointer; transition:.2s; color:#111; box-shadow:0 0 25px rgba(0,255,150,0.4); }
    .controls button:hover { transform:scale(1.1); box-shadow:0 0 30px rgba(0,255,150,0.6); }
    #vu { display:flex; justify-content:center; margin-top:30px; height:60px; }
    .led { width:6px; height:100%; margin:0 2px; background:#004400; border-radius:2px; transition:height .05s, background .05s; }
  </style>
</head>
<body>
  <h1>üéµ Player Autom√°tico JSON</h1>

  <div id="player-container">
    <audio id="player" autoplay></audio>
    <div class="controls">
      <button onclick="togglePlay()">‚ñ∂Ô∏è/‚è∏Ô∏è</button>
    </div>
    <div id="vu"></div>
  </div>

  <script>
    let musicas = [];
    let index = 0;
    const player = document.getElementById("player");
    let isPlaying = true;

    // Carrega playlist do JSON
    fetch("playlist.json")
      .then(res => res.json())
      .then(data => {
        musicas = data;
        loadTrack();
      })
      .catch(err => console.error("Erro ao carregar playlist:", err));

    function loadTrack() {
      if(musicas.length === 0) return;
      player.src = musicas[index];
      player.load();
      player.play();
    }

    function togglePlay() {
      if(isPlaying){ player.pause(); isPlaying=false; }
      else { player.play(); isPlaying=true; }
    }

    // Loop infinito da playlist
    player.addEventListener("ended", () => {
      index = (index + 1) % musicas.length;
      loadTrack();
    });

    // --- VU meter ---
    const NUM_LEDS = 20;
    const vu = document.getElementById("vu");
    const leds = [];
    for(let i=0;i<NUM_LEDS;i++){
      const div = document.createElement("div");
      div.className="led";
      vu.appendChild(div);
      leds.push(div);
    }

    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const analyser = audioContext.createAnalyser();
    const source = audioContext.createMediaElementSource(player);
    source.connect(analyser);
    analyser.connect(audioContext.destination);
    analyser.fftSize = 64;
    const dataArray = new Uint8Array(analyser.frequencyBinCount);

    function animateVU(){
      analyser.getByteFrequencyData(dataArray);
      for(let i=0;i<NUM_LEDS;i++){
        const value=dataArray[i]/255;
        leds[i].style.height=`${value*60}px`;
        leds[i].style.background=`rgb(0,${value*255},0)`;
      }
      requestAnimationFrame(animateVU);
    }

    player.addEventListener("play", ()=>{
      if(audioContext.state==="suspended") audioContext.resume();
      animateVU();
    });
  </script>
</body>
</html>
